package com.ballistic.hospital.controller;import com.ballistic.hospital.entity.DocterType;import com.ballistic.hospital.entity.Note;import com.ballistic.hospital.entity.Patient;import com.ballistic.hospital.repository.DocterTypeRepository;import com.ballistic.hospital.repository.NoteRepository;import com.ballistic.hospital.repository.PatientRepository;import javafx.scene.input.DataFormat;import org.json.simple.JSONObject;import org.json.simple.parser.JSONParser;import org.json.simple.parser.ParseException;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.HttpStatus;import org.springframework.http.ResponseEntity;import org.springframework.web.bind.annotation.*;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Date;import java.util.List;/** * Created by Nabeel on 4/19/2017. */@RestController@RequestMapping("/patient")public class PatientController {    //    // get all the patient    // repository for Patient...    @Autowired    private PatientRepository patientRepository;    @Autowired    private DocterTypeRepository docterTypeRepository;    //    @Autowired    private NoteRepository noteRepository;    // post the new Note    @RequestMapping(value="/addPatient",  method = RequestMethod.POST)    public ResponseEntity<Patient> newPatient(@RequestBody Patient patient ) {        this.patientRepository.save(patient);        return new ResponseEntity<Patient>(patient, HttpStatus.OK);    }    // this is use    // get the All the Patient    @RequestMapping(value="/getAllPatient", method = RequestMethod.GET)    public ResponseEntity<List<Patient>> getAllPatients() {        List<Patient> patientList = patientRepository.findAll();        if(patientList.isEmpty()){            return new ResponseEntity<List<Patient>>(patientList,HttpStatus.NO_CONTENT);        }        return new ResponseEntity<List<Patient>>(patientList,HttpStatus.OK);    }    //    // get the All patient note by mr_no    @RequestMapping(value = "{mrNo}",method = RequestMethod.GET)    public ResponseEntity<List<Note>> getAllPatientNote(@PathVariable("mrNo") Integer mrNo) {          Patient patient = patientRepository.findOne(mrNo);          List<Note> patientNotes = patient.getNote();          // sending note to the front end          // iterate on it         return new ResponseEntity<List<Note>>(patientNotes,HttpStatus.OK);    }    // post the new Note    @RequestMapping(value="/note",  method = RequestMethod.POST)    public ResponseEntity<Patient> addNote(@RequestBody String jsonStr) {        JSONParser parser = new JSONParser();        Patient patient =  new Patient();        try        {            Object object = parser.parse(jsonStr);            //convert Object to JSONObject            JSONObject jsonObject = (JSONObject)object;            System.out.print("-------------------");            System.out.print("-------------------");            System.out.print("-------------------");            System.out.print("-------------------");            // find the patient by the mr_no            patient = patientRepository.find((String) jsonObject.get("mrNo"));            Note note = new Note();            note.setNote((String) jsonObject.get("note"));            String strDate = (String) jsonObject.get("date");            SimpleDateFormat dataFormat = new SimpleDateFormat("yyyy-MM-dd");            Date date = (Date) dataFormat.parse(strDate);            note.setNoteDate(date);            // find the type            DocterType docterType =  docterTypeRepository.findOne((Long) jsonObject.get("typeId"));            note.setNoteType(docterType);            // know save the note            noteRepository.save(note);            List<Note> noteList = patientRepository.getALLNote("mrNo");            noteList.add(note);            patient.setNote(noteList);        }        catch(Exception e)        {            e.printStackTrace();        }        this.patientRepository.save(patient);        return new ResponseEntity<Patient>(patient,HttpStatus.OK);    }}