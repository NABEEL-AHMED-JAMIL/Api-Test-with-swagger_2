import { Component , OnInit } from '@angular/core';import { Docter } from '../_models/index';import { Note } from '../_models/index';import { DocterService } from '../_services/index';import {DocterTypeService} from '../_services/index';import {PatientService} from '../_services/index'; import { Router, ActivatedRoute } from '@angular/router';@Component({    moduleId:module.id,    selector: 'add_note',      templateUrl:'addNote.component.html',    styleUrls: ['addNote.component.css']    })export class AddNote implements OnInit{    // table configuration    public rows:Array<any> = [];    public columns:Array<any> = [            {title: 'Date' , name: 'noteDate'},      {title: 'Docter' , name: 'docter'},       {title:'Note' , name:'note'},    ];        public config:any = {      sorting: {columns: this.columns},      filtering: {filterString: ''},      className: ['table-striped', , 'table-bordered' ]    };    public length:number = 0;    // first get the hero list and put into the obserable method    private findcurrent:any;    private currentType:any;    private currentUser: Docter;    private allSearchType:Array<any>;    private allPatientNotes:Array<any>;    private showCurrentNotes:Array<any>;    private allTabType:Array<any> = [];    private mrNo : any;     constructor(private docterService: DocterService , private docterTypeService:DocterTypeService , private patientService: PatientService , public route: ActivatedRoute,) {        this.currentUser = JSON.parse(localStorage.getItem('currentUser'));    }        public ngOnInit():void {       //               this.loadAllDoctorType();        // get URL parameters        this.route.params.subscribe(params => {this.mrNo = params['mrNo'];});        if(this.mrNo == null){            // here chagne required        }else{            this.patientService.getAllPatientNote(this.mrNo)            .subscribe(allPatientNotes =>             {                this.allPatientNotes = allPatientNotes;                console.log(this.allPatientNotes);                this.showCurrentNotes = this.allPatientNotes;                this.onChangeTable(this.config);                                      });        }    }    private loadAllDoctorType() {         this.docterTypeService.getAllDoctorType().subscribe(allDoctorType => { this.allSearchType = allDoctorType;                                    // remove the first one            this.allSearchType.forEach(element => {                               if(element.type == "ALL"){                  // not push                }else{                  // push                  this.allTabType.push(element);                }            });             this.allTabType.forEach(element => {               element.active = false;                           });        });    }    // table method's// this is the whole structrure of the table that change by(sorting , filtering)  public onChangeTable(config:any):any {          if (config.filtering) {      Object.assign(this.config.filtering, config.filtering);    }    if (config.sorting) {      Object.assign(this.config.sorting, config.sorting);    }    let filteredData = this.changeFilter(this.showCurrentNotes, this.config);    let sortedData = this.changeSort(filteredData, this.config);    this.rows = sortedData;     }// this is the filter that filter the data in the table  public changeFilter(data:any, config:any):any {    let filteredData:Array<any> = data;    this.columns.forEach((column:any) => {      if (column.filtering) {        filteredData = filteredData.filter((item:any) => {          return item[column.name].match(column.filtering.filterString);        });      }    });    if (!config.filtering) {      return filteredData;    }    if (config.filtering.columnName) {      return filteredData.filter((item:any) =>        item[config.filtering.columnName].match(this.config.filtering.filterString));    }    let tempArray:Array<any> = [];    filteredData.forEach((item:any) => {      let flag = false;      this.columns.forEach((column:any) => {        if (item[column.name].toString().match(this.config.filtering.filterString)) {          flag = true;        }      });      if (flag) {        tempArray.push(item);      }    });    filteredData = tempArray;    return filteredData;  }    // this is the sort the change the data table  public changeSort(data:any, config:any):any {    if (!config.sorting) {      return data;    }    let columns = this.config.sorting.columns || [];    let columnName:string = void 0;    let sort:string = void 0;    for (let i = 0; i < columns.length; i++) {      if (columns[i].sort !== '' && columns[i].sort !== false) {        columnName = columns[i].name;        sort = columns[i].sort;      }    }    if (!columnName) {      return data;    }    // simple sorting    return data.sort((previous:any, current:any) => {      if (previous[columnName] > current[columnName]) {        return sort === 'desc' ? -1 : 1;      } else if (previous[columnName] < current[columnName]) {        return sort === 'asc' ? -1 : 1;      }      return 0;    });  }  // this is the note box or the date box and type Tab handler...   note:any;  date:Date;  type:any;   // this is event on the cell Click   public onCellClick(data: any): any {            this.note = data.row.note;       this.date = data.row.noteDate;          }    // other method    private tempPatientNotes:any[] = [];    private element :any ;    private findCurrent(item: any): void {         // find the data        this.allSearchType.forEach(element => {                if(item == element.id){                    this.element = element;                }        });        // search and add it to the temp array         this.allPatientNotes.forEach(element => {                                if(this.element.type == element.noteType.type){                    this.tempPatientNotes.push(element);                }else if(this.element.type == "ALL"){                     this.tempPatientNotes.push(element);                     console.log(this.tempPatientNotes);                                    }                        });        console.log(this.tempPatientNotes);        this.showCurrentNotes = this.tempPatientNotes;        this.onChangeTable(this.config);        this.tempPatientNotes.length = 0;    }    private selectTab(item: any):void {        this.allTabType.forEach(element => {                element.active = false;                        });        this.type = item;        item.active = true;    }    private getcurrentType(value: string): void {         console.log(value);    }      submitNote(event){           //    if(this.note != null && this.date != null && this.type){    //       console.log("this note is note null");    //         //this.patientService.addNote(new Note( this.mrNo , this.note , this.date , this.type.id)).subscribe(data =>{    //          console.log(data);    //        });    //    }else{    //      console.log("this note is null");    //      console.log(this.type);    //    }    // }    }}